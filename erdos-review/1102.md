# Review: Erdos Problem 1102

**Problem:** Properties P and Q for sets related to squarefree shifted sums
**Source:** [erdosproblems.com/1102](https://www.erdosproblems.com/1102)
**Status:** SOLVED (by van Doorn and Tao, 2025)

## Source Problem

Given A subset of N, define:

- **Property P:** For all n >= 1, only finitely many a in A satisfy that n+a is squarefree.
- **Property Q:** Infinitely many n exist such that n+a is squarefree for all a < n in A.

Questions about how rapidly sequences with properties P or Q must increase. Key results (van Doorn-Tao 2025):
- Sequences with property P have density zero.
- Sequences with property Q have upper density at most 6/pi^2.
- 2^n +/- 1 and n! +/- 1 have property Q.
- There exist sequences with property Q achieving density 6/pi^2.

## Current Formalization

```lean
def HasPropertyP (A : Set â„•) : Prop :=
  âˆ€ n â‰¥ 1, {a âˆˆ A | Squarefree (n + a)}.Finite

def HasPropertyQ (A : Set â„•) : Prop :=
  {n : â„• | âˆ€ a âˆˆ A, a < n â†’ Squarefree (n + a)}.Infinite

theorem erdos_1102.density_zero_of_P
    (A : â„• â†’ â„•) (h_inc : StrictMono A) (hP : HasPropertyP (range A)) :
    Tendsto (fun j => (A j / j : â„)) atTop atTop := by sorry

theorem erdos_1102.exists_sequence_with_P
    (f : â„• â†’ â„•) (h_inf : Tendsto f atTop atTop) (h_pos : âˆ€ n, f n â‰  0) :
    âˆƒ A : â„• â†’ â„•, StrictMono A âˆ§
    HasPropertyP (range A) âˆ§
    âˆ€ j : â„•, (A j : â„) / j â‰¤ f j := by sorry

theorem erdos_1102.upper_density_Q
    (A : â„• â†’ â„•) (h_inc : StrictMono A) (hQ : HasPropertyQ (range A)) :
    limsup (fun j : â„•  â†¦ j / A j) atTop â‰¤ 6 / Real.pi^2 := by sorry

theorem erdos_1102.lower_density_Q_exists :
    âˆƒ A : â„• â†’ â„•, StrictMono A âˆ§
    (âˆ€ j, Squarefree (A j)) âˆ§
    HasPropertyQ (range A) âˆ§
    Tendsto (fun j : â„•  â†¦ (j / A j : â„)) atTop (ð“ (6 / Real.pi^2)) := by sorry
```

## Critical Analysis

### 1. Property P definition is correct (OK)

`HasPropertyP` matches the source: for all n >= 1, the set {a in A : n+a is squarefree} is finite. The formalization correctly uses `Set.Finite` and the separator `{a âˆˆ A | Squarefree (n + a)}`.

### 2. Property Q definition (MINOR)

The source says "infinitely many n exist such that n+a is squarefree for all a < n" (where a ranges over A). The formalization uses `âˆ€ a âˆˆ A, a < n â†’ Squarefree (n + a)`, which correctly captures "for all a in A with a < n." This is a faithful translation.

### 3. Density zero theorem is well-stated (OK)

The theorem `density_zero_of_P` states that if A has property P and is strictly increasing, then A(j)/j -> infinity. This is the correct way to express "A has density 0" via the enumeration function: if a_j/j -> infinity, the counting function grows sublinearly, hence density 0.

### 4. Converse theorem is well-stated (OK)

The theorem `exists_sequence_with_P` says that for any function f going to infinity, there exists a sequence with property P growing at most as fast as f. This captures the result that sequences with property P can grow arbitrarily slowly (subject to having density 0).

### 5. Upper density bound for Q is correct (OK)

The upper density of a sequence is lim sup of j/A(j). The bound `limsup ... <= 6/pi^2` correctly states that the upper density is at most 6/pi^2 (= 1/zeta(2)).

### 6. Existence of optimal Q sequence is correct (OK)

The theorem `lower_density_Q_exists` shows the bound is tight: there exists a squarefree sequence with property Q whose density converges to 6/pi^2.

### 7. Status correctly marked as SOLVED (OK)

The `@[category research solved, AMS 11]` annotation correctly reflects the solved status.

### 8. Missing: remaining open question about P for specific sequences (MINOR)

The source notes it remains open whether sequences like 2^n +/- 1 and n! +/- 1 have property P. This open question is not formalized, though it is more of a sub-problem.

### 9. Division in Lean types (MINOR)

In `Tendsto (fun j => (A j / j : â„))`, the expression `A j / j` is natural number division before coercion to R, which would give the floor. It should be `(A j : â„) / (j : â„)` or `((A j : â„) / j)`. Looking more carefully, the coercion annotation `: â„` applies to the division, so Lean should interpret this as real division. In `upper_density_Q`, the expression `j / A j` has the same issue -- it looks like it is `(j : â„•) / (A j : â„•)` coerced, but with `â†¦` syntax and the atTop filter on â„•, the types may resolve correctly. This needs careful checking.

Actually, looking at the fourth theorem, the expression `(j / A j : â„)` should coerce both j and A j to â„ before dividing. In `density_zero_of_P`, the expression `(A j / j : â„)` similarly should do real division. This appears correct.

## What a proper formalization would look like

The current formalization is excellent and closely matches the source results. Only very minor improvements are possible:

```lean
-- The formalization is already quite good. One could add:

/-- It remains open whether {2^n - 1} has property P. -/
@[category research open, AMS 11]
theorem erdos_1102.powers_of_two_minus_one_P :
    answer(sorry) â†” HasPropertyP (range fun n => 2^n - 1) := by sorry
```

## Confidence: **90%**

This is one of the best formalizations in the batch. The definitions of properties P and Q are faithful, the four theorems accurately capture the main results from the van Doorn-Tao resolution, the density notions are correctly expressed via enumeration functions, and the status annotation is correct. The only minor concerns are potential type coercion subtleties with division and the absence of remaining open sub-questions.
