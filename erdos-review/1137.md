# Review: Erdos Problem 1137

**Problem:** Ratio of consecutive prime gap products to squared max gap
**Source:** [erdosproblems.com/1137](https://www.erdosproblems.com/1137)
**Status:** OPEN

## Source Problem

Let d_n = p_{n+1} - p_n, where p_n denotes the n-th prime number. Is it true that:

  max_{n < x} d_n * d_{n-1} / (max_{n < x} d_n)^2 -> 0 as x -> infinity?

## Current Formalization

```lean
@[category research open, AMS 11]
theorem erdos_1137 :
    answer(sorry) ‚Üî
     Tendsto (fun x ‚Ü¶
        (((range x).sup (fun n ‚Ü¶ (primeGap n) * (primeGap (n - 1))) : ‚Ñï) : ‚Ñù) /
        (((range x).sup primeGap : ‚Ñï) : ‚Ñù) ^ 2) atTop (ùìù 0) := by
  sorry
```

Where `primeGap n = (n+1).nth Nat.Prime - n.nth Nat.Prime`.

## Critical Analysis

### 1. Correct mathematical structure (MINOR positive)

The formalization captures the ratio max_{n < x} (d_n * d_{n-1}) / (max_{n < x} d_n)^2 -> 0. The numerator takes the sup over `range x` of `primeGap n * primeGap (n-1)`, and the denominator is the square of `sup primeGap`. The `Tendsto ... atTop (nhds 0)` correctly encodes convergence to 0.

### 2. Index shift issue with primeGap (MODERATE)

`primeGap n` is defined as `(n+1).nth Nat.Prime - n.nth Nat.Prime`, which gives p_{n+2} - p_{n+1} (0-indexed). So `primeGap n` corresponds to d_{n+1} in 1-indexed notation (where d_n = p_{n+1} - p_n). The product `primeGap n * primeGap (n-1)` computes d_{n+1} * d_n, which represents consecutive gap products. The source asks for d_n * d_{n-1}, i.e., consecutive gap products. Since we're taking the supremum over all n < x, the index shift doesn't affect the mathematical content -- we're still looking at the maximum product of consecutive gaps.

### 3. n = 0 edge case with subtraction (MINOR)

When n = 0, `primeGap (n - 1) = primeGap (0 - 1)`. Since this is natural number subtraction, `0 - 1 = 0`, so the n = 0 term computes `primeGap 0 * primeGap 0 = (primeGap 0)^2`. This is a spurious term not present in the source. However, since `primeGap 0` is finite and fixed, this doesn't affect the limit behavior -- it adds a constant to the supremum of the numerator, which is eventually dominated.

### 4. Correct use of answer elaborator (MINOR positive)

The use of `answer(sorry)` is appropriate for an open yes/no problem.

### 5. Range of supremum (MINOR)

The source takes max over "n < x" where x -> infinity. The formalization takes sup over `range x` which gives {0, 1, ..., x-1}, i.e., n < x. This matches.

### 6. Natural number division concern (MODERATE)

The numerator `(range x).sup (fun n => primeGap n * primeGap (n-1))` is a natural number, and the denominator `((range x).sup primeGap)^2` is also natural. The coercion to `‚Ñù` is applied to each before division, so the division is real-valued. This is correct.

## What a proper formalization would look like

The current formalization is quite good. A minor improvement would handle the n=0 edge case:

```lean
theorem erdos_1137 :
    answer(sorry) ‚Üî
     Tendsto (fun x ‚Ü¶
        (((range x).sup (fun n ‚Ü¶ (primeGap (n + 1)) * (primeGap n)) : ‚Ñï) : ‚Ñù) /
        (((range x).sup primeGap : ‚Ñï) : ‚Ñù) ^ 2) atTop (ùìù 0) := by
  sorry
```

(Using `primeGap (n+1) * primeGap n` avoids the natural number subtraction issue at n=0.)

## Confidence: **80%**

The formalization faithfully captures the mathematical content of the problem. The ratio of max consecutive gap product to squared max gap converging to 0 is correctly encoded. The minor issues are: (1) a spurious n=0 term due to natural number subtraction, which does not affect the limit, and (2) the index convention is off by one but does not change the mathematical content since the supremum ranges over all valid indices. Overall, this is a good formalization.
