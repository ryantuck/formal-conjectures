# Review: Erdos Problem 1109

**Problem:** Largest squarefree sumset in {1,...,N}
**Source:** [erdosproblems.com/1109](https://www.erdosproblems.com/1109)
**Status:** OPEN

## Source Problem

Let f(N) be the size of the largest subset A of {1,...,N} such that every element of A+A is squarefree. Estimate f(N). In particular, is f(N) <= N^{o(1)}, or even f(N) <= (log N)^{O(1)}?

Known bounds:
- Erdos-Sarkozy: log N << f(N) << N^{3/4} * log N
- Konyagin: log(log N) * (log N)^2 << f(N) << N^{11/15 + o(1)}

## Current Formalization

```lean
/-- f(N) = the size of the largest A ⊆ {1,...,N} with A+A squarefree. -/
noncomputable def f (N : ℕ) : ℕ :=
  sSup {k | ∃ A : Finset ℕ, A ⊆ Finset.Icc 1 N ∧ A.card = k ∧
    ∀ a ∈ A, ∀ b ∈ A, Squarefree (a + b)}

/-- Lower bound: f(N) >> (log N)^2 * log(log N) (Konyagin). -/
@[category research open, AMS 11]
theorem squarefree_sumsets_lower :
    ∃ c > 0, ∀ᶠ N : ℕ in Filter.atTop,
      c * (Real.log N)^2 * Real.log (Real.log N) ≤ (f N : ℝ) := by
  sorry

/-- Upper bound: f(N) << N^{11/15 + o(1)} (Konyagin). -/
@[category research open, AMS 11]
theorem squarefree_sumsets_upper :
    ∀ ε > 0, ∃ C > 0, ∀ᶠ N : ℕ in Filter.atTop,
      (f N : ℝ) ≤ C * (N : ℝ) ^ (11/15 + ε) := by
  sorry

/-- Open: Is f(N) ≤ N^{o(1)}? -/
@[category research open, AMS 11]
theorem squarefree_sumsets_subpolynomial :
    answer(sorry) ↔ ∀ ε > 0, ∃ C > 0, ∀ᶠ N in Filter.atTop,
      (f N : ℝ) ≤ C * (N : ℝ) ^ ε := by
  sorry
```

## Critical Analysis

### 1. Definition of f(N) is correct (GOOD)

`f(N) = sSup {k | exists A : Finset N, A ⊆ Icc 1 N, A.card = k, all pairwise sums squarefree}` correctly defines the extremal function. The use of `Finset.Icc 1 N` matches the source's {1,...,N}. The squarefree condition `∀ a ∈ A, ∀ b ∈ A, Squarefree (a + b)` correctly captures A+A being squarefree (all pairwise sums, including a+a).

### 2. Well-definedness of sSup (MODERATE concern)

The set `{k | ...}` is a set of natural numbers. Since A ⊆ Finset.Icc 1 N, we have A.card ≤ N, so the set is bounded above by N. However, `sSup` on `ℕ` with `ConditionallyCompleteLattice` requires the set to be nonempty and bounded. The set is nonempty (k = 0 works with A = empty, since the vacuous condition holds) and bounded (by N). Technically, `sSup` on ℕ uses `Nat.sSup` which returns 0 for the empty set, but the set here is nonempty so this is fine. A `Finset.sup` or explicit maximum formulation might be cleaner, but `sSup` works correctly here.

### 3. Lower bound matches Konyagin (GOOD)

The lower bound `c * (log N)^2 * log(log N) ≤ f(N)` matches the known result. The formalization correctly uses `∃ c > 0` with `∀ᶠ N in atTop`, which captures the asymptotic "big Omega" notation.

### 4. Upper bound matches Konyagin (GOOD)

The upper bound `f(N) ≤ C * N^{11/15 + ε}` for all ε > 0 correctly captures `N^{11/15 + o(1)}`. The encoding `∀ ε > 0, ∃ C > 0, ∀ᶠ N in atTop` is the standard way to express o(1) in the exponent.

### 5. Subpolynomial question is correctly formalized (GOOD)

The open question "Is f(N) ≤ N^{o(1)}?" is correctly formalized as `∀ ε > 0, ∃ C > 0, ∀ᶠ N in atTop, f(N) ≤ C * N^ε`. The use of `answer(sorry)` is appropriate for a yes/no open question.

### 6. Missing the stronger conjecture f(N) ≤ (log N)^{O(1)} (MINOR)

The source also asks whether the even stronger bound f(N) ≤ (log N)^{O(1)} holds. This is not formalized. It could be added as an additional `answer(sorry)` theorem, but its absence is not critical since the subpolynomial question is the primary open question.

### 7. Numeric literal 11/15 (MINOR)

In Lean 4, `11/15` in the expression `(N : ℝ) ^ (11/15 + ε)` -- if these are natural number literals, `11/15` evaluates to `0` in ℕ. This needs to be `(11 : ℝ)/15` or `((11 : ℝ)/15 + ε)` to get the correct real division. This is a potential type-coercion bug that would make the upper bound statement trivially true (it would say f(N) ≤ C * N^ε, which is the subpolynomial conjecture rather than the known upper bound).

**Update:** Looking more carefully, since ε is already `ε : ℝ` (from `∀ ε > 0`), the expression `11/15 + ε` is in ℝ context, so `11/15` should be elaborated as `(11 : ℝ) / (15 : ℝ)`. Lean's type inference should handle this correctly since the addition with ε forces the ℝ context. This is likely fine, but it would be worth verifying at build time.

### 8. Both bounds tagged as "open" (MINOR)

The lower and upper bounds are known results (by Konyagin), not open problems. Tagging them as `research open` is slightly inaccurate. They could be tagged as `research solved`. However, since they are part of the overall open problem of estimating f(N), this is a minor issue.

## What a proper formalization would look like

The current formalization is already very good. Possible minor improvements:

```lean
-- Add the stronger conjecture about polylogarithmic bound:
@[category research open, AMS 11]
theorem squarefree_sumsets_polylog :
    answer(sorry) ↔ ∃ C > 0, ∀ᶠ N in Filter.atTop,
      (f N : ℝ) ≤ (Real.log N) ^ C := by
  sorry

-- Ensure 11/15 is correctly parsed as a real:
-- In the upper bound, make the real division explicit:
--   (f N : ℝ) ≤ C * (N : ℝ) ^ ((11 : ℝ)/15 + ε)
```

## Confidence: **85%**

The rewritten formalization is a massive improvement over the original. The definition of f(N) correctly captures the extremal function. The lower bound, upper bound, and subpolynomial question all match the source problem's content. The main concerns are: (1) the 11/15 literal might need explicit real casting to avoid integer division (though type inference likely handles it), (2) the stronger (log N)^{O(1)} conjecture is missing, and (3) the known bounds are tagged as open rather than solved. These are all minor issues. The core mathematical content is faithfully captured.
